---
phase: 03-search-filtering-export
plan: "01"
type: execute
wave: 1
depends_on: []
files_modified:
  - Cargo.toml
  - src/cli.rs
autonomous: true
requirements:
  - CLI-01
  - CLI-02
  - CLI-03
  - EXPORT-01
  - QUERY-01
  - QUERY-02
  - QUERY-03
  - QUERY-04
  - QUERY-05
  - QUERY-06

must_haves:
  truths:
    - "All subcommands accept short aliases (new, ls, get, up, rm, rel, dep, deps, dump)"
    - "rtik list accepts --status, --claimed, --unclaimed, --claimer, --search flags"
    - "rtik export subcommand exists with --json flag and same filter flags as list"
    - "serde and serde_json are available as dependencies"
  artifacts:
    - path: "src/cli.rs"
      provides: "Commands enum with aliases, updated ListArgs, new ExportArgs, Commands::Export variant"
      contains: "alias = \"new\""
    - path: "Cargo.toml"
      provides: "serde and serde_json dependencies"
      contains: "serde_json"
  key_links:
    - from: "src/cli.rs Commands::Export"
      to: "src/lib.rs run()"
      via: "pattern match on Commands::Export variant"
      pattern: "Commands::Export"
    - from: "src/cli.rs ListArgs"
      to: "src/ticket.rs ListFilter"
      via: "filter fields mapped in lib.rs build_filter()"
      pattern: "ListArgs.*search|status|claimed"
---

<objective>
Add serde dependencies, CLI command aliases, filter flags to ListArgs, and the new ExportArgs/Export command to cli.rs.

Purpose: Establishes the CLI surface that list filtering and export wiring will build on. Must compile cleanly as a pure structural change before any logic is added.
Output: Updated Cargo.toml with serde/serde_json; updated cli.rs with aliases on all Commands variants, filter flags on ListArgs, ExportArgs struct, and Commands::Export variant.
</objective>

<execution_context>
@/Users/marcusmccurdy/.claude/get-shit-done/workflows/execute-plan.md
@/Users/marcusmccurdy/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/cli.rs
@src/lib.rs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add serde dependencies to Cargo.toml</name>
  <files>Cargo.toml</files>
  <action>
    Run:
      cargo add serde --features derive
      cargo add serde_json

    This adds serde 1.x with derive macros and serde_json 1.x to [dependencies]. These are needed by ticket.rs for TicketExport serialization in Plan 02.

    Verify the additions compile with `cargo check` before proceeding.
  </action>
  <verify>cargo check --quiet 2>&amp;1 | grep -v warning; grep -q "serde_json" Cargo.toml</verify>
  <done>Cargo.toml contains both serde (with features = ["derive"]) and serde_json dependencies, and `cargo check` succeeds.</done>
</task>

<task type="auto">
  <name>Task 2: Add command aliases, filter flags, and Export command to cli.rs</name>
  <files>src/cli.rs</files>
  <action>
    Rewrite src/cli.rs with the following changes (preserve all existing args structs unchanged, only modify Commands enum and ListArgs):

    **Commands enum** — add `#[command(alias = "...")]` to each variant per the locked alias set. Clap automatically lowercases variant names, so `Create` is already `create`; the alias `"new"` adds an additional name. Important: `Claim` lowercases to `claim` automatically — no alias needed for `claim` itself, but add `#[command(alias = "claim")]` anyway only if needed; check RESEARCH.md pitfall 2 — it is harmless but may warn in debug. Per RESEARCH.md recommendation, skip the redundant `claim` alias. Add `Export(ExportArgs)` as a new variant with `#[command(alias = "dump")]`.

    Alias mapping (from CONTEXT.md — NON-NEGOTIABLE):
    - Create   → alias "new"
    - List     → alias "ls"
    - Get      → alias "get"
    - Update   → alias "up"
    - Delete   → alias "rm"
    - Claim    → no alias needed (canonical name is already "claim")
    - Release  → alias "rel"
    - Block    → no alias in the locked set
    - Dep      → alias "dep"
    - Deps     → alias "deps"
    - Export   → alias "dump"  (new variant)

    **ListArgs struct** — add these new fields after the existing `timestamps: bool`:
    ```rust
    #[arg(long, help = "Filter by status (passes through to DB; returns empty if invalid)")]
    pub status: Option<String>,
    #[arg(long, help = "Show only claimed tickets")]
    pub claimed: bool,
    #[arg(long, help = "Show only unclaimed tickets")]
    pub unclaimed: bool,
    #[arg(long, help = "Filter by claimer name (exact match)")]
    pub claimer: Option<String>,
    #[arg(long = "search", help = "Substring search in name+description (repeatable, all terms must match)")]
    pub search: Vec<String>,
    ```

    Note: `--status` on ListArgs does NOT use parse_status value_parser — the user locked "accepts whatever status values are already stored in the DB" with no new enum. Invalid values silently return empty results.

    **ExportArgs struct** — add new struct:
    ```rust
    #[derive(Args)]
    pub struct ExportArgs {
        #[arg(long, help = "Filter by status")]
        pub status: Option<String>,
        #[arg(long, help = "Show only claimed tickets")]
        pub claimed: bool,
        #[arg(long, help = "Show only unclaimed tickets")]
        pub unclaimed: bool,
        #[arg(long, help = "Filter by claimer name")]
        pub claimer: Option<String>,
        #[arg(long = "search", help = "Substring search in name+description (repeatable)")]
        pub search: Vec<String>,
        #[arg(long, help = "Output as JSON array instead of plain text")]
        pub json: bool,
    }
    ```

    Keep parse_status function unchanged. After edits, run `cargo check` to confirm no compile errors.
  </action>
  <verify>cargo check --quiet 2>&amp;1 | grep -v warning; grep -q 'alias = "new"' src/cli.rs; grep -q 'alias = "dump"' src/cli.rs; grep -q 'ExportArgs' src/cli.rs; grep -q 'pub search: Vec' src/cli.rs</verify>
  <done>cli.rs compiles cleanly, contains aliases on Create/List/Get/Update/Delete/Release/Dep/Deps/Export variants, ListArgs has the 5 new filter fields, ExportArgs struct exists with filter fields plus --json flag, Export(ExportArgs) is a Commands variant.</done>
</task>

</tasks>

<verification>
Run:
  cargo check --quiet

Expected: zero errors (warnings acceptable).

Spot-check alias coverage:
  grep -E 'alias = "(new|ls|get|up|rm|rel|dep|deps|dump)"' src/cli.rs | wc -l

Expected: 9 lines (one per alias).

Spot-check filter fields on ListArgs:
  grep -A 20 'pub struct ListArgs' src/cli.rs

Expected: timestamps, status, claimed, unclaimed, claimer, search fields all present.
</verification>

<success_criteria>
- `cargo check` passes with zero errors
- All 9 aliases present in cli.rs
- ListArgs has 5 new filter fields (status, claimed, unclaimed, claimer, search)
- ExportArgs struct defined with filter fields + --json
- Commands::Export(ExportArgs) variant present with alias "dump"
- Cargo.toml contains serde (features = ["derive"]) and serde_json
</success_criteria>

<output>
After completion, create `.planning/phases/03-search-filtering-export/03-01-SUMMARY.md`
</output>
